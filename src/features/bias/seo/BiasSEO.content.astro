---
/**
 * !Este elemento va dentro de cada una de las rutas dinámicas y no de los index de las páginas generales
 */

import ContentSEO from "@/seo/ContentSEO.astro";
import { SITE_DEFAULT_CONFIG } from "@/global/siteInfo";
import { convertDateToISO8601 } from "@utils/validatingDate";
import { type CollectionEntry } from "astro:content";

const { entry } = Astro.props;

const bias = entry as CollectionEntry<"bias">;
const { data } = bias;
const { cover, description, keywords, publishDate, lastTimeEdited, titleTag } =
  data;

const postName = `${titleTag} - ${SITE_DEFAULT_CONFIG.title}`;

const postDescription = `${description} - ${SITE_DEFAULT_CONFIG.title}`;

const ogImage = new URL("./og-image.png", Astro.site);
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const justInCaseNoCoverSrc = cover?.src?.src
  ? `${SITE_DEFAULT_CONFIG.url}${cover.src.src}`
  : ogImage;
const justInCaseNoCoverAlt = cover.alt || postName;

// Validación de fechas. lastTimeEdited puede ser undefined en la collection pero en la práctica no pero para evitar el error hago la validación
const publisDateInISO = convertDateToISO8601(publishDate);
const lastTimeEditedInISO = convertDateToISO8601(
  !lastTimeEdited ? publishDate : lastTimeEdited
);
---

<ContentSEO
  postName={postName}
  postDescription={postDescription}
  canonicalURL={canonicalURL}
  justInCaseNoCoverSrc={justInCaseNoCoverSrc}
  justInCaseNoCoverAlt={justInCaseNoCoverAlt}
  publisDateInISO={publisDateInISO}
  lastTimeEditedInISO={lastTimeEditedInISO}
  keywords={keywords}
/>
